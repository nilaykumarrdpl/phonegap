<!DOCTYPE html>
<!--
    Copyright (c) 2012-2014 Adobe Systems Incorporated. All rights reserved.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>
    <head>
        <script src="js/jquery-1.12.0.min.js"></script>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, target-densitydpi=medium-dpi, user-scalable=0" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>Kazo.com</title>
        <link rel="apple-touch-icon" href="icon.png">
    </head>
    <body>
        <div class="app">
            <h1>PhoneGap</h1>
            <div id="deviceready" class="blink">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
            </div>
        </div>
    
        <div class="container" id="container">
            <iframe frameborder="0" id="MyIFrame" class="video loader-iframe"></iframe>       
            <div class="video loader-div">
                <div class="header-language-background">
                  <div class="header-language-container">
                    <div class="header-main-part">
                      <div class="header-main-inner-sects">
                        <!-- Cart -->
                        <div class="left-icon-area-sec">
                          <div class="header-minicart"> <a class="skip-link skip-cart  no-count" href="#header-cart"> <i class="fa fa-cart-plus"></i>  </a>
                            <div class="block block-cart skip-content" id="header-cart">
                              <div class="minicart-message" id="minicart-error-message"></div>
                              <div class="minicart-message" id="minicart-success-message"></div>
                            </div>
                          </div>
                          <div class="header-miniacnt">
                            <div class="mobile-hidden-part" style="display: none;"> <a class="skip-link skip-account" href="#header-account"> <i class="fa fa-user"></i> <span class="label">Account</span> </a> </div>
                            <div> <a class="signin mobile-navigation" href="javascript:void(0)"> <i class="fa fa-user"></i> </a> </div>
                            <!-- Account -->
                            <div class="skip-content" id="header-account">
                              
                            </div>
                          </div>
                          <div class="eliipsiis"> <a class="top-app-navig" href="javascript:void(0);"> <i class="fa fa-ellipsis-v"></i></a> </div>
                        </div>
                        <div class="slide-header">
                          <!-- Navigation -->
                          <div class="store-language-container"></div>
                          <!-- Skip Links -->
                          <div class="skip-links"> <a class="common-toggle" href="#header-nav"> <i class="fa fa-navicon"></i>  </a> </div>
                          <!-- Search -->
                          <a class="logo-loader" href="http://54.169.245.192/kazo/">
                          <div class="app-logo"> <img src="fonts/k.jpg"> </div>
                          </a>
                          <div class="srch-head-app"><a href="javascript:void(0);"><i class="fa fa-search"></i></a></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="loading_mask" id="load_light" style="position: fixed; top: 0px; left: 0px;">
                    <div class="top-slide-with-linking">
                        <a id="login-access-link" class="active-top-slide-linking" href="javascript::void();" style="color:#ff9900; text-decoration:underline;font-size:12px; padding:10px 0 0 10px">Sign In</a>
                        <a id="register-link" href="javascript::void();" style="color:#ff9900; text-decoration:underline;font-size:12px; padding:10px 0 0 10px">New User</a>
                        <a id="forgot-password-link" href="javascript::void();" style="color:#ff9900; text-decoration:underline;font-size:12px; padding:10px 0 0 10px">Forgot Password</a>
                    
                    </div> 
                    <div class="loading_image">
                    <div class="progress-bar-validation">
                    <img alt="loading your required product" src="http://54.169.245.192/kazo/skin/frontend/rwd/kazo/images/loading_p.gif">
                    <span> Loading... Please wait </span>
                    </div>
                    <button class="fb-login-in-app" onClick="connectSocialLogin()">Facebook Login</button> <br /><br /> OR
                    <form id="login-access-form" method="post" name="login-access-form">
                      <input type="hidden" name="form_type" value="signin" />
                      <input type="email" name="email" id="email" value="" placeholder="Email Address" required><br />
                      <input type="password" placeholder="Password" name="password" id="password" required><br /><br />
                      <button id="submit" name="submit" title="sigin"  class="button procedd-account" type="button" onClick="connectByEmail()"><span><span>Submit</span></span></button>
                    </form>
                    <form id="forgot-password-form" method="post" name="forgot-password-form" style="display:none;">
                      <input type="hidden" name="form_type" value="forgot-password" />
                      <input type="email" name="email" id="email_f" value="" placeholder="Email Address" required><br />
                      <button id="submit" name="submit" title="forgot-password" class="button fgt-psw" type="button" onClick="sendPasswordByEmail()"><span><span>Submit</span></span></button>
                    </form>
                    <form id="register-form" method="post" name="register-form" style="display:none;">
                      <input type="hidden" name="form_type" value="register" />
                      <input type="text" name="firstname" id="firstname_r" value="" placeholder="First Name" required><br />
                      <input type="text" name="lastname" id="lastname_r" value="" placeholder="Last Name" required><br />
                      <input type="tel" name="mobile" id="mobile_r" value="" placeholder="Mobile Number" required maxlength="10"><br />
                      <input type="email" name="email" id="email_r" value="" placeholder="Email Address" required><br />
                      <input type="password" name="password" placeholder="Password" id="password_r" required=""><br />
                      <input type="password" name="confirm_password" placeholder="Confirm Password" id="confirm_password_r" required=""><br />
                      <button id="submit" name="submit" title="forgot-password" class="button proceed-to-rgstr" type="button" onClick="registerByEmail()"><span><span>Submit</span></span></button>
                    </form>
                    </div>
                </div>
            </div>

        </div>
        <div class="container-offline" style="display:none">
            No network connection ...
        </div>        
        <script type="text/javascript" src="cordova.js"></script>  
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
            document.addEventListener("deviceready", onDeviceReady , false);
            var pushNotification;
            function onDeviceReady() {
                alert('progress-bar-validation');
                $('.progress-bar-validation').hide();
                var push = PushNotification.init({ "android": {"senderID": "267514034297", "icon": "phonegap", "iconColor": "blue"},
                            "ios": {"alert": "true", "badge": "true", "sound": "true"}, "windows": {} } );
                push.on('registration', function(data) {
                    console.log(data.registrationId);
                    $("#gcm_id").html(data.registrationId);
                    var deviceId = data.registrationId;

                    $.ajax({
                        type: 'GET',
                        url: 'http://54.169.245.192/kazo/script/gcm/getJson.php',
                        dataType: 'jsonp',
                        async: false,
                        jsonpCallback: 'jsoncallback',
                        crossDomain: true,
                        data: {deviceId:deviceId},
                        cache: false,
                    }); 
            });
            push.on('notification', function(data) {
                console.log(data.message);
                alert(data.title+" Message: " +data.message+" image: " +data.image);
            });
            $('.device-ready').hide();
            $('.loader-div').show();
        }
        var fbLoginSuccess = function (userData) 
        {
            alert("UserInfo: " + JSON.stringify(userData));
            facebookConnectPlugin.getAccessToken(function(token) 
            {
                alert("Token: " + token);
            }, function(err) {
                alert("Could not get access token: " + err);
            }); 
            alert(userData.authResponse.userID);
            facebookConnectPlugin.api(userData.authResponse.userID+"/?fields=id,email,name", ["user_birthday"],
            function (result) 
            {
                /* alerts:
                    {
                        "id": "000000123456789",
                        "email": "myemail@example.com"
                    }
                */
                alert("Result: " + JSON.stringify(result));
                var accessToken = userData.authResponse.accessToken;
                var ID = result.id;
                var email = result.email;
                var name = result.name;
                $.ajax({
                  type: 'GET',
                  url: 'http://54.169.245.192/kazo/script/gcm/getUser.php',
                  dataType: 'jsonp',
                  async: false,
                  jsonpCallback: 'jsoncallbackUser',
                  crossDomain: true,
                  data: {accessToken:accessToken,ID:ID,email:email,name:name},
                  cache: false,
                }); 
            },
            function (error) 
            {
                alert("Failed: " + error);
            });
        }
        
        function jsoncallbackUser(data)
        {
            if($.trim(data) == "false") {
              alert("Fail to recived data");
            }
            else {
              alert("Successfully data recived");
              //onload, call loadIframe() function
                alert(data.user_detail.email);
                loadIframe(data.user_detail.email); 
            }        
        }
        function connectSocialLogin() {
                alert('ahhaa');
                //$('.loader-iframe').addClass('video');
                facebookConnectPlugin.login(["public_profile","email", "user_birthday"],
                    fbLoginSuccess,
                    function (error) { alert("" + error) }
                );
        }
        
        function connectByEmail() {
                var email = $('#email').val();
                var password = $('#password').val();
                if(email == ''){alert('Please enter your email');$('#email').focus();return;}
                if(password == ''){alert('Please enter your password');$('#password').focus();return;}
                var formId = '#login-access-form';
                var form = $(formId); 
                var params = form.serialize();
                //alert(params);
                $('.progress-bar-validation').show();                
                $.ajax({
                  type: 'GET',
                  url: 'http://54.169.245.192/kazo/connectedByEmail.php',
                  dataType: 'jsonp',
                  async: false,
                  jsonpCallback: 'jsoncallbackConnectedByEmail',
                  crossDomain: true,
                  data: params,
                  cache: false,
                });                 
        }
        function sendPasswordByEmail() {
                var email = $('#email_f');
                if (!validateEmail(email.val())) { alert('Invalid Email Address');email.focus();return;}
                var formId = '#forgot-password-form';
                var form = $(formId); 
                var params = form.serialize();
                //alert(params);
                $('.progress-bar-validation').show();
                $.ajax({
                  type: 'GET',
                  url: 'http://54.169.245.192/kazo/connectedByEmail.php',
                  dataType: 'jsonp',
                  async: false,
                  jsonpCallback: 'jsoncallbackConnectedByEmail',
                  crossDomain: true,
                  data: params,
                  cache: false,
                });                 
        }
        function registerByEmail() {
                var formId = '#register-form';
                var firstname_r = $('#firstname_r');
                var lastname_r = $('#lastname_r');
                var mobile_r = $('#mobile_r');
                var email = $('#email_r');
                var password_r = $('#password_r');
                var confirm_password_r = $('#confirm_password_r');
                if(firstname_r.val() == ''){alert('Please enter your firstname');firstname_r.focus();return;}
                if(lastname_r.val() == ''){alert('Please enter your lastname');lastname_r.focus();return;}
                if(!validatePhone(mobile_r.val())){alert('Please enter a valid number');mobile_r.focus();return;}
                if (!validateEmail(email.val())) { alert('Invalid Email Address');email.focus();return;}
                if(password_r.val() == '' || password_r.val().length <6){alert('Please enter 6 or more characters.');password_r.focus();return;}
                if(password_r.val() != confirm_password_r.val()){alert('Please make sure your passwords match');confirm_password_r.focus();return;}

                var form = $(formId); 
                var params = form.serialize();
                alert(params);
                $('.progress-bar-validation').show();
                $.ajax({
                  type: 'GET',
                  url: 'http://54.169.245.192/kazo/connectedByEmail.php',
                  dataType: 'jsonp',
                  async: false,
                  jsonpCallback: 'jsoncallbackConnectedByEmail',
                  crossDomain: true,
                  data: params,
                  cache: false,
                });                 
        }
        // Function that validates email address through a regular expression.
        function validateEmail(sEmail) {
            var filter = /^[\w\-\.\+]+\@[a-zA-Z0-9\.\-]+\.[a-zA-z0-9]{2,4}$/;
            if (filter.test(sEmail)) {
            return true;
            }
            else {
            return false;
            }
        }
        // Function that validates phone number through a regular expression.
        function validatePhone(sPhone) {
            var filter = /[0-9 -()+]+$/;
            if (filter.test(sPhone) && (sPhone.length >= 10)) {
            return true;
            }
            else {
            return false;
            }
        }
        function jsoncallbackConnectedByEmail(data) {
            //alert('Recieved');
            var result1 = JSON.stringify(data);
            $('.progress-bar-validation').hide();
            if(!data.error) {
                //alert(data.htmlData.email);
                if(data.form_type == 'forgot-password'){
                    alert(JSON.stringify(data.htmlData));
                }else{
                    loadIframe(data.htmlData.email);
                }
            } else {
                alert(data.htmlData);
            }
        }
        
        function loadIframe(email){
            $('.loader-iframe').css("display", "block");
            $( ".loader-div" ).remove();
        
            var iframeURL = 'http://54.169.245.192/kazo/autoLogin.php';
            var iframeID = 'MyIFrame';
            var password = '12345678';

            //setiFrame's SRC attribute
            var iFrameWin = document.getElementById(iframeID);
            iFrameWin.src = iframeURL + "?email="+email+"&password="+password;
            //alert(iFrameWin.src);
        }

        function checkConnection() {
            var  networkConnectionType =  navigator.network.connection.type;
            alert('Connection Type: ' +  networkConnectionType );
            if(networkConnectionType === 'none' || networkConnectionType === null || networkConnectionType === "unknown"){
                $('.container').hide();
                $('.container-offline').show();
           }
        }            
        </script>
        <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){
            $('#forgot-password-link').click(function(){
			$('#register-link,#login-access-link').removeClass( "active-top-slide-linking" );
                $('#register-form').hide();
                $('#login-access-form').hide();
                $('#forgot-password-form').show();
				$('#forgot-password-link').addClass( "active-top-slide-linking" );
            });
            $('#register-link').click(function(){
			$('#forgot-password-link,#login-access-link').removeClass( "active-top-slide-linking" );
                $('#register-form').show();
                $('#login-access-form').hide();
                $('#forgot-password-form').hide();
				$('#register-link').addClass( "active-top-slide-linking" );
            });
            $('#login-access-link').click(function(){
			$('#forgot-password-link,#register-link').removeClass( "active-top-slide-linking" );
                $('#register-form').hide();
                $('#login-access-form').show();
                $('#forgot-password-form').hide();
				$('#login-access-link').addClass( "active-top-slide-linking" );
            });
        });
        </script>
        <script>
        function jsoncallback(data)
        {
            if($.trim(data) == "false") {
              alert("Fail to recived data");
            }
            else {
              alert("Successfully data recived");
            }        
        }
        </script>
    </body>
</html>
